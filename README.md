# 贴吧数据分析

一个用于 **抓取论坛帖子 → OCR / AI 处理 → 自动生成并回复帖子** 的轻量化自动化系统。

> 当前阶段：早期开发 / 系统骨架搭建  
> 核心目标：流程清晰、可协作、可扩展

---

## 项目简介

本项目旨在构建一条完整但尽量简单的数据处理流水线，用于：

1. 定时抓取最新论坛帖子  
2. 将帖子内容与图片结构化存储  
3. 通过 OCR / AI 对内容进行补充与分类  
4. 自动生成并发布回复内容  

整个系统以 **数据库状态驱动**，各阶段解耦，便于后续替换或扩展。

---

## 系统整体流程
```mermaid
    A[Cron Job] --> B[抓取帖子]
    B --> C{是否新帖?}
    C -- 是 --> D[写入数据库]
    C -- 否 --> X[停止翻页]
    D --> E[OCR]
    E --> F[AI 打标签]
    F --> G[生成回复]
    G --> H[API 回复]
```


---

## 一、数据抓取（Crawler）

- 由 **cron job 每小时触发**
- 按 **帖子创建时间倒序** 抓取
- 分页逻辑：
  - page=1 → 最新 0–50 条
  - page=2 → 50–100 条
  - 以此类推

### 首次运行（First time）
- 抓取过去 **24 小时内的所有帖子**
- 全部存入数据库

### 后续运行（Second pull）
- 从 page=1 开始抓取
- 对每一页：
  - 若帖子 ID **全部不存在于数据库** → 继续下一页
  - 若 **部分已存在** → 说明已抓取到历史数据，停止
- 避免重复抓取，保证效率

### 图片处理
- 图片下载到本地存储
- 数据库中仅保存本地图片路径

---

## 二、数据库设计（核心字段）

| 字段名            | 说明            |
|----------------|---------------|
| thread_id      | 帖子 / 主题唯一 ID  |
| thread_content | 帖子文本内容        |
| ......         | 待定字段          |
| img_path       | 本地图片路径        |
| img_content    | OCR 识别文本（可为空） |
| tag            | 帖子标签（不可为空）    |
| status         | 当前处理状态        |

### status 取值说明
- `1`：已下载（Download）
- `2`：已 OCR
- `3`：已 AI 处理

### tag 示例
- 交友  
- 闲聊  
- 游戏  
- Others  

---

## 三、OCR / AI 处理

- OCR：
  - 输入：图片
  - 输出：文字内容
- AI：
  - 对帖子内容进行语义分析
  - 自动打标签
- 处理逻辑由数据库 `status` 字段驱动
- 处理完成后更新数据库状态

---

## 四、回复生成与发布

- 根据数据库中的帖子信息生成回复模板：
  - 个人信息
  - 原帖链接
- 判断：
  - 回复现有帖子
  - 或新建帖子（基于主帖 ID）
- 通过 API 调用完成实际回复

---

## 项目结构（暂定）
```angular2html
project-root/
├── crawler/ # 抓取逻辑
├── ai/ # OCR / AI 处理
├── reply/ # 回复生成与发布
├── data/
│ ├── images/ # 本地图片存储
│ └── db/ # 数据库相关
├── scripts/ # 定时任务 / 工具脚本
└── README.md
```
---
## 近期计划（Roadmap）

- [ ] 抓取逻辑稳定化（分页 + 停止条件）
- [ ] 数据库结构最终确认
- [ ] OCR 流程接入
- [ ] AI 打标签初版
- [ ] 回复模板 v1

---

## License

TBD



